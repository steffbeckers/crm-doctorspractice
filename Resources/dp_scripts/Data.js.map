{"version":3,"sources":["dp_scripts/Data.js","dp_scripts/Data.ts"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","throw","result","done","then","apply","DP","Data","RetrieveAsync","entityName","id","cols","keyAttribute","replace","toLowerCase","RetrieveMultipleAsync","records","length","Error","urlEnding","indexOf","join","req","XMLHttpRequest","open","Xrm","Page","context","getClientUrl","setRequestHeader","onreadystatechange","readyState","status","results","JSON","parse","response","statusText","send","UpdateAsync","entity","stringify"],"mappings":"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","file":"dp_scripts/Data.js","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator.throw(value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments)).next());\n    });\n};\nvar DP;\n(function (DP) {\n    var Data;\n    (function (Data) {\n        /**\n         * Retrieve a record from the web api\n         * @param entityName The name of the entity without the trailing 's'\n         * @param id Guid of the record\n         * @param cols columns to retrieve\n         * @param keyAttribute keyAttribute defaults to entity + 'id', use this to override key attribute (ex activity)\n         */\n        function RetrieveAsync(entityName, id, cols, keyAttribute) {\n            return __awaiter(this, void 0, void 0, function* () {\n                if (!keyAttribute) {\n                    keyAttribute = entityName + \"id\";\n                }\n                entityName = entityName + \"s\";\n                id = id.replace(/[{}]/g, \"\").toLowerCase();\n                var records = yield Data.RetrieveMultipleAsync(entityName + \"?$filter=\" + keyAttribute + \" eq \" + id, cols);\n                if (records.length == 0) {\n                    throw new Error(\"RetrieveAsync error: Entity not found.\");\n                }\n                if (records.length > 1) {\n                    throw new Error(\"RetrieveAsync error: Found more then 1\");\n                }\n                return records[0];\n            });\n        }\n        Data.RetrieveAsync = RetrieveAsync;\n        function RetrieveMultipleAsync(urlEnding, cols) {\n            return new Promise((resolve, reject) => {\n                if (cols) {\n                    if (urlEnding.indexOf('?') == -1) {\n                        urlEnding += \"?\";\n                    }\n                    else {\n                        urlEnding += \"&\";\n                    }\n                    urlEnding += \"$select=\" + cols.join(',');\n                }\n                var req = new XMLHttpRequest();\n                req.open(\"GET\", Xrm.Page.context.getClientUrl() + \"/api/data/v8.0/\" + urlEnding, true);\n                req.setRequestHeader(\"OData-MaxVersion\", \"4.0\");\n                req.setRequestHeader(\"OData-Version\", \"4.0\");\n                req.setRequestHeader(\"Accept\", \"application/json\");\n                req.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\");\n                req.setRequestHeader(\"Prefer\", \"odata.include-annotations=\\\"OData.Community.Display.V1.FormattedValue\\\"\");\n                req.onreadystatechange = function () {\n                    if (this.readyState === 4) {\n                        req.onreadystatechange = null;\n                        if (this.status === 200) {\n                            var results = JSON.parse(this.response).value;\n                            resolve(results);\n                        }\n                        else {\n                            reject(this.statusText);\n                        }\n                    }\n                };\n                req.send();\n            });\n        }\n        Data.RetrieveMultipleAsync = RetrieveMultipleAsync;\n        function UpdateAsync(urlEnding, entity) {\n            return new Promise((resolve, reject) => {\n                var req = new XMLHttpRequest();\n                req.open(\"PATCH\", Xrm.Page.context.getClientUrl() + \"/api/data/v8.0/\" + urlEnding, true);\n                req.setRequestHeader(\"OData-MaxVersion\", \"4.0\");\n                req.setRequestHeader(\"OData-Version\", \"4.0\");\n                req.setRequestHeader(\"Accept\", \"application/json\");\n                req.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\");\n                req.onreadystatechange = function () {\n                    if (this.readyState === 4) {\n                        req.onreadystatechange = null;\n                        if (this.status === 204) {\n                            //Success - No Return Data - Do Something\n                            resolve(true);\n                        }\n                        else {\n                            reject(this.statusText);\n                        }\n                    }\n                };\n                req.send(JSON.stringify(entity));\n            });\n        }\n        Data.UpdateAsync = UpdateAsync;\n    })(Data = DP.Data || (DP.Data = {}));\n})(DP || (DP = {}));\n","namespace DP.Data\r\n{\r\n    /**\r\n     * Retrieve a record from the web api\r\n     * @param entityName The name of the entity without the trailing 's'\r\n     * @param id Guid of the record\r\n     * @param cols columns to retrieve\r\n     * @param keyAttribute keyAttribute defaults to entity + 'id', use this to override key attribute (ex activity)\r\n     */\r\n    export async function RetrieveAsync(entityName: string, id: string, cols?: Array<string>, keyAttribute?: string)\r\n    {\r\n        if (!keyAttribute)\r\n        {\r\n            keyAttribute = entityName + \"id\";\r\n        }\r\n\r\n        entityName = entityName + \"s\";\r\n\r\n        id = id.replace(/[{}]/g, \"\").toLowerCase();\r\n\r\n        var records = await Data.RetrieveMultipleAsync(entityName + \"?$filter=\" + keyAttribute + \" eq \" + id, cols);\r\n        if (records.length == 0)\r\n        {\r\n            throw new Error(\"RetrieveAsync error: Entity not found.\");\r\n        }\r\n        if (records.length > 1)\r\n        {\r\n            throw new Error(\"RetrieveAsync error: Found more then 1\");\r\n        }\r\n\r\n        return records[0];\r\n    }\r\n\r\n    export function RetrieveMultipleAsync(urlEnding: string, cols?: Array<string>)\r\n    {\r\n        return new Promise((resolve: (records: Array<any>) => any, reject: (statusText: string) => any) =>\r\n        {\r\n            if (cols)\r\n            {\r\n                if (urlEnding.indexOf('?') == -1)\r\n                {\r\n                    urlEnding += \"?\";\r\n                }\r\n                else\r\n                {\r\n                    urlEnding += \"&\";\r\n                }\r\n\r\n                urlEnding += \"$select=\" + cols.join(',');\r\n            }\r\n\r\n            var req = new XMLHttpRequest();\r\n            req.open(\"GET\", Xrm.Page.context.getClientUrl() + \"/api/data/v8.0/\" + urlEnding, true);\r\n            req.setRequestHeader(\"OData-MaxVersion\", \"4.0\");\r\n            req.setRequestHeader(\"OData-Version\", \"4.0\");\r\n            req.setRequestHeader(\"Accept\", \"application/json\");\r\n            req.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\");\r\n            req.setRequestHeader(\"Prefer\", \"odata.include-annotations=\\\"OData.Community.Display.V1.FormattedValue\\\"\");\r\n\r\n            req.onreadystatechange = function ()\r\n            {\r\n                if (this.readyState === 4)\r\n                {\r\n                    req.onreadystatechange = null;\r\n                    if (this.status === 200)\r\n                    {\r\n                        var results = JSON.parse(this.response).value;\r\n                        resolve(results);\r\n                    }\r\n                    else\r\n                    {\r\n                        reject(this.statusText);\r\n                    }\r\n                }\r\n            };\r\n\r\n            req.send();\r\n        });\r\n    }\r\n\r\n    export function UpdateAsync(urlEnding: string, entity: {}) {\r\n        return new Promise((resolve: (succes: Boolean) => any, reject: (statusText: string) => any) => {\r\n            var req = new XMLHttpRequest();\r\n            req.open(\"PATCH\", Xrm.Page.context.getClientUrl() + \"/api/data/v8.0/\" + urlEnding, true);\r\n            req.setRequestHeader(\"OData-MaxVersion\", \"4.0\");\r\n            req.setRequestHeader(\"OData-Version\", \"4.0\");\r\n            req.setRequestHeader(\"Accept\", \"application/json\");\r\n            req.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\");\r\n            req.onreadystatechange = function () {\r\n                if (this.readyState === 4) {\r\n                    req.onreadystatechange = null;\r\n                    if (this.status === 204) {\r\n                        //Success - No Return Data - Do Something\r\n                        resolve(true);\r\n                    }\r\n                    else {\r\n                        reject(this.statusText);\r\n                    }\r\n                }\r\n            };\r\n            req.send(JSON.stringify(entity));\r\n        });\r\n    }\r\n}"],"sourceRoot":"/source/"}